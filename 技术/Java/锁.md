# 乐观锁和悲观锁

## 乐观锁

> 乐观的认为别人不会修改数据，操作数据时不会去加锁。在最终提交更新时才检查数据是否有冲突。

**实现方式**：

1. 使用数据版本号；

2. 使用时间戳



## 悲观锁

> 很悲观，认为别人都会操作数据，每次操作时都会上锁。

关系型数据库中常用如：行锁、表锁、读锁、写锁

共享锁（读锁S）：数据加了共享锁后，其他事务可以继续添加共享锁，但只能读取数据；

排它锁（写锁X）：数据加了排它锁后，不能在加任何其他锁。获取到锁可以对数据进行读写操作，又叫独占锁；

[共享锁和排它锁](\数据库\排它锁和共享锁.md)



## Java中加锁的方式有哪些？

1. 内部锁：synchronized

2. 显示锁：java.util.concurrent.locks.Lock

3. 读写锁ReadWriteLock：读写各自加锁互不影响。当写加锁时，不影响读，读操作可以继续执行。

4. 锁的可重入性

   ​	Java中的synchronizde同步块是可重入的，在同步块内如果还有一个，则内部的同步块持有上层的锁，也可以继续执行；
   最大作用就是避免死锁；
   自旋锁：让后面的线程继续等待，直到锁释放才开始执行；

   

## 乐观锁的业务场景及实现方式



## 自旋锁-splinLock

> 尝试获取锁的线程不会立即阻塞，而是采用循环的方式获取锁，这样可以减少线程上下文切换，但会比较消耗CPU；

手写一个自旋锁？

